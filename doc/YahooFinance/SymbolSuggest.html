<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />

  <title>Module: YahooFinance::SymbolSuggest</title>

  <link rel="stylesheet" href="../rdoc.css" type="text/css" media="screen" />

  <script src="../js/jquery.js" type="text/javascript" charset="utf-8"></script>
  <script src="../js/thickbox-compressed.js" type="text/javascript" charset="utf-8"></script>
  <script src="../js/quicksearch.js" type="text/javascript" charset="utf-8"></script>
  <script src="../js/darkfish.js" type="text/javascript" charset="utf-8"></script>

</head>
<body id="top" class="module">

  <div id="metadata">
    <div id="home-metadata">
      <div id="home-section" class="section">
        <h3 class="section-header">
          <a href="../index.html">Home</a>
          <a href="../index.html#classes">Classes</a>
          <a href="../index.html#methods">Methods</a>
        </h3>
      </div>
    </div>

    <div id="file-metadata">
      <div id="file-list-section" class="section">
        <h3 class="section-header">In Files</h3>
        <div class="section-body">
          <ul>
          
            <li><a href="../lib/yahoofinance-symbolsuggest/version_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="lib/yahoofinance-symbolsuggest/version.rb">lib/yahoofinance-symbolsuggest/version.rb</a></li>
          
            <li><a href="../lib/yahoofinance-symbolsuggest_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="lib/yahoofinance-symbolsuggest.rb">lib/yahoofinance-symbolsuggest.rb</a></li>
          
          </ul>
        </div>
      </div>

      
    </div>

    <div id="class-metadata">
      

      

      

      
      <!-- Method Quickref -->
      <div id="method-list-section" class="section">
        <h3 class="section-header">Methods</h3>
        <ul class="link-list">
          
          <li><a href="#method-c-query">::query</a></li>
          
          <li><a href="#method-c-results_from_jsonp">::results_from_jsonp</a></li>
          
          <li><a href="#method-c-suggestions_from_jsonp">::suggestions_from_jsonp</a></li>
          
          <li><a href="#method-c-suggestions_from_results">::suggestions_from_results</a></li>
          
          <li><a href="#method-c-url_from_symbol">::url_from_symbol</a></li>
          
        </ul>
      </div>
      

      
    </div>

    <div id="project-metadata">
      
      
      <div id="fileindex-section" class="section project-section">
        <h3 class="section-header">Files</h3>
        <ul>
        
          <li class="file"><a href="../Gemfile.html">Gemfile</a></li>
        
          <li class="file"><a href="../Rakefile.html">Rakefile</a></li>
        
        </ul>
      </div>
      

      <div id="classindex-section" class="section project-section">
        <h3 class="section-header">Class/Module Index
          <span class="search-toggle"><img src="../images/find.png"
            height="16" width="16" alt="[+]"
            title="show/hide quicksearch" /></span></h3>
        <form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
        <fieldset>
          <legend>Quicksearch</legend>
          <input type="text" name="quicksearch" value=""
            class="quicksearch-field" />
        </fieldset>
        </form>

        <ul class="link-list">
        
          <li><a href="../YahooFinance.html">YahooFinance</a></li>
        
          <li><a href="../YahooFinance/SymbolSuggest.html">YahooFinance::SymbolSuggest</a></li>
        
        </ul>
        <div id="no-class-search-results" style="display: none;">No matching classes.</div>
      </div>

      
    </div>
  </div>

  <div id="documentation">
    <h1 class="module">YahooFinance::SymbolSuggest</h1>

    <div id="description" class="description">
      
    </div><!-- description -->

    
    <div id="5Buntitled-5D" class="documentation-section">
      

      

      
      <!-- Constants -->
      <div id="constants-list" class="section">
        <h3 class="section-header">Constants</h3>
        <dl>
        
          <dt><a name="Callback">Callback</a></dt>
          
          <dd class="description"><p>This constant is important for two reasons:</p>
<ol><li>
<p>it appears in the URL query;</p>
</li><li>
<p>it appears in the JSONP response.</p>
</li></ol>

<p>The URL query string is everything after the question mark. The
undocumented non-public interface to Yahoo’s symbol-suggest auto-completion
services requires two query fields: query and callback, where “query”
specifies the symbol on which to base the suggestions, and where “callback”
specifies the JavaScript callback function. But note, this callback
function cannot have just any name for the Yahoo service to accept the
request. It must match this string.</p></dd>
          
        
        </dl>
      </div>
      

      

      <!-- Methods -->
      
      <div id="public-class-method-details" class="method-section section">
        <h3 class="section-header">Public Class Methods</h3>

      
        <div id="query-method" class="method-detail ">
          <a name="method-c-query"></a>

          
          <div class="method-heading">
            <span class="method-name">query</span><span
              class="method-args">(symbol)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Queries the given ticker symbol or company name against Yahoo Finance’s
symbol suggest web service. Answers an array of prioritised suggestions in
the form of hashes where each hash has the following keys.</p>
<dl><dt>exch</dt>
<dd>
<p>symbol of the exchange, e.g. NYQ for NYSE</p>
</dd><dt>exchDisp</dt>
<dd>
<p>display name for the exchange, e.g. “NYSE”</p>
</dd><dt>name</dt>
<dd>
<p>name of the company</p>
</dd><dt>symbol</dt>
<dd>
<p>ticker symbol</p>
</dd><dt>type</dt>
<dd>
<p>type of stock, e.g. S for “Equity”</p>
</dd><dt>typeDisp</dt>
<dd>
<p>display type for stock</p>
</dd></dl>

<h2>Design Notes</h2>

<p>The design uses a module-scoped method to wrap the GET request sent to
Yahoo Finance, though this may need refactoring at some point in the
future. The <tt>query</tt> method handles the query synchronously, meaning
that the caller waits for the response. Future implementations may abstract
away the response handling as well as the request handling, in order to
support other caller-callee paradigms, including asynchronous ones.</p>

<p>To facilitate alternative approaches, including asynchronous loading, the
design refactors URL-from-symbol and suggestions-from-JSONP behaviour as
separate module methods. Hence <tt>query</tt> is just a convenience method
that sends a synchronous HTTP GET request using the Ruby standard library.</p>
            

            
            <div class="method-source-code" id="query-source">
<pre>
<span class="ruby-comment"># File lib/yahoofinance-symbolsuggest.rb, line 95</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">query</span>(<span class="ruby-identifier">symbol</span>)
  <span class="ruby-identifier">suggestions_from_jsonp</span>(<span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">HTTP</span>.<span class="ruby-identifier">get</span>(<span class="ruby-identifier">url_from_symbol</span>(<span class="ruby-identifier">symbol</span>)))
<span class="ruby-keyword">end</span></pre>
            </div><!-- query-source -->
            
          </div>

          

          
        </div><!-- query-method -->

      
        <div id="results_from_jsonp-method" class="method-detail ">
          <a name="method-c-results_from_jsonp"></a>

          
          <div class="method-heading">
            <span class="method-name">results_from_jsonp</span><span
              class="method-args">(jsonp)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Parses JSONP and extracts the encoded set of results. Answers a hash
comprising two keys: <tt>Query</tt> and <tt>Result</tt>. The <tt>Query</tt>
value is the original query string. The <tt>Result</tt> value is an array
of hashes, the results proper. Each hash has keys describing the symbol
suggestion, including <tt>symbol</tt> for the ticker symbol, <tt>name</tt>
for the name of the company, etc. See query method.</p>
            

            
            <div class="method-source-code" id="results_from_jsonp-source">
<pre>
<span class="ruby-comment"># File lib/yahoofinance-symbolsuggest.rb, line 43</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">results_from_jsonp</span>(<span class="ruby-identifier">jsonp</span>)
  <span class="ruby-comment"># The answer from the GET request to Yahoo Finance's symbol-suggest</span>
  <span class="ruby-comment"># service is a piece of JSONP: JSON with padding, where the padding is the</span>
  <span class="ruby-comment"># callback function. The following padding parser utilises Ruby 1.9 String</span>
  <span class="ruby-comment"># methods. Is that a good thing? It makes the implementation dependent on</span>
  <span class="ruby-comment"># 1.9.</span>
  <span class="ruby-identifier">prefix</span> = <span class="ruby-constant">Callback</span> <span class="ruby-operator">+</span> <span class="ruby-string">'('</span>
  <span class="ruby-identifier">suffix</span> = <span class="ruby-string">')'</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">jsonp</span>.<span class="ruby-identifier">start_with?</span>(<span class="ruby-identifier">prefix</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">jsonp</span>.<span class="ruby-identifier">end_with?</span>(<span class="ruby-identifier">suffix</span>)
    <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">jsonp</span>[<span class="ruby-identifier">prefix</span>.<span class="ruby-identifier">length</span>, <span class="ruby-identifier">jsonp</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">prefix</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">suffix</span>.<span class="ruby-identifier">length</span>])[<span class="ruby-string">&quot;ResultSet&quot;</span>]
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- results_from_jsonp-source -->
            
          </div>

          

          
        </div><!-- results_from_jsonp-method -->

      
        <div id="suggestions_from_jsonp-method" class="method-detail ">
          <a name="method-c-suggestions_from_jsonp"></a>

          
          <div class="method-heading">
            <span class="method-name">suggestions_from_jsonp</span><span
              class="method-args">(jsonp)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Answers an array of symbol suggestions given some JSONP sent by the Yahoo
Finance symbol-suggestion service.</p>
            

            
            <div class="method-source-code" id="suggestions_from_jsonp-source">
<pre>
<span class="ruby-comment"># File lib/yahoofinance-symbolsuggest.rb, line 67</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">suggestions_from_jsonp</span>(<span class="ruby-identifier">jsonp</span>)
  <span class="ruby-identifier">suggestions_from_results</span>(<span class="ruby-identifier">results_from_jsonp</span>(<span class="ruby-identifier">jsonp</span>))
<span class="ruby-keyword">end</span></pre>
            </div><!-- suggestions_from_jsonp-source -->
            
          </div>

          

          
        </div><!-- suggestions_from_jsonp-method -->

      
        <div id="suggestions_from_results-method" class="method-detail ">
          <a name="method-c-suggestions_from_results"></a>

          
          <div class="method-heading">
            <span class="method-name">suggestions_from_results</span><span
              class="method-args">(results)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Answers an array of hashes representing symbol suggestions given a set of
results; in other words, discards the <tt>Query</tt> key. The results
argument typically comes from the <a
href="SymbolSuggest.html#method-c-results_from_jsonp">results_from_jsonp</a>
method.</p>
            

            
            <div class="method-source-code" id="suggestions_from_results-source">
<pre>
<span class="ruby-comment"># File lib/yahoofinance-symbolsuggest.rb, line 61</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">suggestions_from_results</span>(<span class="ruby-identifier">results</span>)
  <span class="ruby-identifier">results</span>[<span class="ruby-string">&quot;Result&quot;</span>]
<span class="ruby-keyword">end</span></pre>
            </div><!-- suggestions_from_results-source -->
            
          </div>

          

          
        </div><!-- suggestions_from_results-method -->

      
        <div id="url_from_symbol-method" class="method-detail ">
          <a name="method-c-url_from_symbol"></a>

          
          <div class="method-heading">
            <span class="method-name">url_from_symbol</span><span
              class="method-args">(symbol)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Answers an URL given a ticker symbol or company name; Yahoo Finance matches
both simultaneously. Send an HTTP GET request to this URL and Yahoo will
reply with a padded JSON response containing some useful suggestions for
matching companies. Use <a
href="SymbolSuggest.html#method-c-suggestions_from_jsonp">suggestions_from_jsonp</a>
to decode the response.</p>
            

            
            <div class="method-source-code" id="url_from_symbol-source">
<pre>
<span class="ruby-comment"># File lib/yahoofinance-symbolsuggest.rb, line 31</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">url_from_symbol</span>(<span class="ruby-identifier">symbol</span>)
  <span class="ruby-comment"># Escape the query string using CGI rather than URI because URI fails to</span>
  <span class="ruby-comment"># encode ampersands.</span>
  <span class="ruby-constant">URI</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;http://d.yimg.com/aq/autoc?query=#{CGI.escape(symbol)}&amp;callback=#{Callback}&quot;</span>)
<span class="ruby-keyword">end</span></pre>
            </div><!-- url_from_symbol-source -->
            
          </div>

          

          
        </div><!-- url_from_symbol-method -->

      
      </div><!-- public-class-method-details -->
    
    </div><!-- 5Buntitled-5D -->
  

  </div><!-- documentation -->

  <div id="validator-badges">
    <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
    <p><small>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish
      Rdoc Generator</a> 2</small>.</p>
  </div>

</body>
</html>

